# Local Kubernetes deployment values for Elder
# Override default values for local development/testing

global:
  imageRegistry: ""  # Don't set global registry - configure per service
  imagePullSecrets: []

# Elder API configuration
api:
  enabled: true
  replicaCount: 1  # Single replica for local
  image:
    repository: registry-dal2.penguintech.io/elder-api
    pullPolicy: IfNotPresent
    tag: "latest"

  service:
    type: NodePort  # Use NodePort for local access
    port: 80
    targetPort: 5000
    nodePort: 30400  # Fixed port for easy access

  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "500m"

  autoscaling:
    enabled: false

  # Ingress configuration
  ingress:
    enabled: true
    className: "nginx"
    annotations:
      cert-manager.io/cluster-issuer: "cloudflare"
      nginx.ingress.kubernetes.io/ssl-redirect: "true"
    hosts:
      - host: elder.penguintech.io
        paths:
          - path: /api
            pathType: Prefix
    tls:
      - secretName: penguintech-wildcard-tls
        hosts:
          - elder.penguintech.io

# Elder Web UI
web:
  enabled: true
  replicaCount: 1
  image:
    repository: registry-dal2.penguintech.io/elder-web
    pullPolicy: IfNotPresent
    tag: "latest"

  service:
    type: NodePort
    port: 80
    targetPort: 80
    nodePort: 30300  # Fixed port for web UI

  # Environment variables for web container
  env:
    VITE_API_URL: "https://elder.penguintech.io/api/v1"

  resources:
    requests:
      memory: "64Mi"
      cpu: "50m"
    limits:
      memory: "128Mi"
      cpu: "200m"

  # Web-specific security context for nginx
  securityContext:
    runAsNonRoot: false
    runAsUser: 0  # nginx needs root

  # Ingress configuration
  ingress:
    enabled: true
    className: "nginx"
    annotations:
      cert-manager.io/cluster-issuer: "cloudflare"
      nginx.ingress.kubernetes.io/ssl-redirect: "true"
    hosts:
      - host: elder.penguintech.io
        paths:
          - path: /
            pathType: Prefix
    tls:
      - secretName: penguintech-wildcard-tls
        hosts:
          - elder.penguintech.io

  nodeSelector: {}
  tolerations: []
  affinity: {}

# Elder gRPC server configuration
grpc:
  enabled: true
  replicaCount: 1
  image:
    repository: registry-dal2.penguintech.io/elder-grpc
    pullPolicy: IfNotPresent
    tag: "latest"

  service:
    type: ClusterIP
    port: 50051

  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "500m"

  config:
    maxWorkers: 4  # Reduced for local
    requireLicense: false  # Disable for local testing

# gRPC-Web proxy (Envoy)
envoy:
  enabled: true
  replicaCount: 1
  image:
    repository: registry-dal2.penguintech.io/elder-envoy
    pullPolicy: IfNotPresent
    tag: "latest"

  service:
    type: ClusterIP
    port: 8080
    adminPort: 9901

  resources:
    requests:
      memory: "64Mi"
      cpu: "50m"
    limits:
      memory: "128Mi"
      cpu: "100m"

# PostgreSQL configuration
postgresql:
  enabled: true
  image:
    registry: docker.io
    repository: bitnami/postgresql
    tag: "latest"
  auth:
    username: elder
    password: "elder-local-password"
    database: elder
  primary:
    persistence:
      enabled: true
      size: 5Gi
      storageClass: "longhorn"
    resources:
      requests:
        memory: "256Mi"
        cpu: "100m"
      limits:
        memory: "512Mi"
        cpu: "500m"

# Redis configuration
redis:
  enabled: true
  image:
    registry: docker.io
    repository: bitnami/redis
    tag: "latest"
  auth:
    enabled: true
    password: "redis-local-password"
  master:
    persistence:
      enabled: true
      size: 1Gi
      storageClass: "longhorn"
    resources:
      requests:
        memory: "64Mi"
        cpu: "50m"
      limits:
        memory: "128Mi"
        cpu: "100m"

# Elder application configuration
config:
  # Flask configuration
  flaskEnv: development
  secretKey: "local-dev-secret-key-change-in-production"
  debug: false

  # License configuration (disabled for local)
  license:
    key: ""
    serverUrl: "https://license.penguintech.io"
    productName: "elder"

  # Database URL will be auto-configured from postgresql subchart
  databaseUrl: ""

  # Redis URL will be auto-configured from redis subchart
  redisUrl: ""

  # Authentication providers (disabled for local)
  auth:
    samlEnabled: false
    oauth2Enabled: false
    ldapEnabled: false
    guestEnabled: true  # Enable guest login for local testing

  # Logging
  logging:
    level: INFO
    syslogEnabled: false

  # Metrics
  metricsEnabled: true

# ServiceAccount
serviceAccount:
  create: true
  annotations: {}
  name: "elder"

# Pod security context
podSecurityContext: {}  # Use defaults from Dockerfile

# Security context (overridden per-service if needed)
securityContext: {}  # Use defaults from Dockerfile

# Monitoring
monitoring:
  enabled: false  # Disable for local
  serviceMonitor:
    enabled: false

# Network policies
networkPolicy:
  enabled: false  # Disable for local

# Ingress (configured per-service above)
