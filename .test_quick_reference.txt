╔════════════════════════════════════════════════════════════════════════════╗
║                    TEST REMEDIATION QUICK REFERENCE                        ║
║                         Elder v3.0.5 - Jan 2026                            ║
╚════════════════════════════════════════════════════════════════════════════╝

CURRENT STATUS: 89/120 tests passing (74%)
TARGET: 120/120 tests passing (100%)

┌────────────────────────────────────────────────────────────────────────────┐
│ FAILING TESTS BY CATEGORY                                                  │
├────────────────────────────────────────────────────────────────────────────┤
│ API Validation Tests       27/28  (1 failing)   Email NULL byte injection   │
│ REST API Tests            34/43  (9 failing)   Missing fields/models       │
│ Integration Tests          1/9   (8 failing)   Database setup              │
│ Web UI Tests             27/40  (13 failing)   Routes/headers/CSRF         │
└────────────────────────────────────────────────────────────────────────────┘

┌────────────────────────────────────────────────────────────────────────────┐
│ 5-MINUTE FIXES (Phase 1)                                                   │
├────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│ FIX 1: Email NULL Byte Injection (1 test)                   [5 min]        │
│  File: apps/api/models/schemas.py                                          │
│  Add: if '\x00' in value: raise ValueError(...)                            │
│                                                                             │
│ FIX 2: Organization Tenant ID (9 tests)                     [15 min]       │
│  File: apps/api/api/v1/organizations.py                                    │
│  Add: if 'tenant_id' not in data: data['tenant_id'] = 1                    │
│                                                                             │
│ FIX 3: Update E2E Test Data (5 tests)                       [20 min]       │
│  File: tests/e2e/test_api_crud.py                                          │
│       tests/e2e/test_create_endpoints_auth.py                              │
│  Changes:                                                                   │
│    • Label: key → name, value → description                                │
│    • Add organization_id to all CREATE calls                               │
│    • Add reporter_id to issue creation                                     │
│                                                                             │
│ FIX 4: Integration Test Setup (8 tests)                     [25 min]       │
│  File: tests/integration/test_workflow_complete.py                         │
│  Changes:                                                                   │
│    • Add tenant_id=1 to Organization()                                     │
│    • Add cleanup fixture for database                                      │
│                                                                             │
│ PHASE 1 TOTAL: 65 MINUTES → 23 TESTS FIXED                                │
│                                                                             │
└────────────────────────────────────────────────────────────────────────────┘

┌────────────────────────────────────────────────────────────────────────────┐
│ MEDIUM-EFFORT FIXES (Phase 2)                                              │
├────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│ FIX 5: Create Pydantic Models (3 tests)                     [90 min]       │
│  Create:                                                                    │
│    • shared/py_libs/py_libs/pydantic/models/milestone.py                   │
│    • shared/py_libs/py_libs/pydantic/models/datastore.py                   │
│    • shared/py_libs/py_libs/pydantic/models/webhook.py                     │
│  Update: shared/py_libs/py_libs/pydantic/models/__init__.py                │
│                                                                             │
│ FIX 6: Update Endpoint Handlers (3 endpoints)               [60 min]       │
│  Files:                                                                     │
│    • apps/api/api/v1/milestones.py                                         │
│    • apps/api/api/v1/data_stores.py                                        │
│    • apps/api/api/v1/webhooks.py                                           │
│  Change: Use @validated_request decorator + Pydantic models                │
│                                                                             │
│ PHASE 2 TOTAL: 150 MINUTES → 3 TESTS FIXED                                │
│                                                                             │
└────────────────────────────────────────────────────────────────────────────┘

┌────────────────────────────────────────────────────────────────────────────┐
│ WEB UI FIXES (Phase 3)                                                     │
├────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│ FIX 7: Admin Pages (5 tests)                              [60-120 min]     │
│  Check if React components exist for /admin/*                              │
│  If missing: Create minimal admin panel components                         │
│                                                                             │
│ FIX 8: SPA Routing (4 tests)                               [15 min]        │
│  File: webui nginx config                                                  │
│  Add: try_files $uri $uri/ /index.html;                                    │
│                                                                             │
│ FIX 9: Security Headers (2 tests)                          [30 min]        │
│  Add to nginx or Flask middleware:                                         │
│    • X-Content-Type-Options: nosniff                                       │
│    • X-Frame-Options: SAMEORIGIN                                           │
│    • Content-Security-Policy: default-src 'self'                           │
│                                                                             │
│ FIX 10: CSRF Token Implementation (2 tests)                [45-90 min]     │
│  Verify: CSRF tokens in auth responses and form submissions                │
│                                                                             │
│ PHASE 3 TOTAL: 150-255 MINUTES → 13 TESTS FIXED                           │
│                                                                             │
└────────────────────────────────────────────────────────────────────────────┘

┌────────────────────────────────────────────────────────────────────────────┐
│ REQUIRED FIELDS BY RESOURCE                                                │
├────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│ ORGANIZATION:  name (+ auto-derive tenant_id)                              │
│ ENTITY:        name, entity_type, organization_id                          │
│ ISSUE:         title, reporter_id, (+ organization_id recommended)         │
│ SERVICE:       name, organization_id                                       │
│ PROJECT:       name, organization_id                                       │
│ LABEL:         name (NOT key)                                              │
│ MILESTONE:     title, organization_id                                      │
│ DATA_STORE:    name, organization_id, data_classification, storage_type   │
│ WEBHOOK:       name, url, events, organization_id                          │
│                                                                             │
└────────────────────────────────────────────────────────────────────────────┘

┌────────────────────────────────────────────────────────────────────────────┐
│ VALIDATION COMMANDS                                                        │
├────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│ After Phase 1: pytest tests/test_api_basic.py -v                           │
│ After Phase 2: pytest tests/e2e/test_api_crud.py -v                        │
│ After Phase 3: pytest tests/e2e/test_web_ui.py -v                          │
│ Final Check:  pytest tests/ -v --tb=short                                  │
│                                                                             │
│ Expected: 120/120 PASSED ✅                                                │
│                                                                             │
└────────────────────────────────────────────────────────────────────────────┘

┌────────────────────────────────────────────────────────────────────────────┐
│ FILE CHANGES SUMMARY                                                       │
├────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│ FILES TO MODIFY (Production Code):                                         │
│   1. apps/api/models/schemas.py                    (+ null byte check)      │
│   2. apps/api/api/v1/organizations.py              (+ tenant_id auto)       │
│   3. apps/api/api/v1/milestones.py                 (+ @validated_request)   │
│   4. apps/api/api/v1/data_stores.py                (+ @validated_request)   │
│   5. apps/api/api/v1/webhooks.py                   (+ @validated_request)   │
│   6. shared/py_libs/py_libs/pydantic/models/__init__.py (+ exports)         │
│                                                                             │
│ FILES TO MODIFY (Test Code):                                               │
│   1. tests/test_api_basic.py                       (small updates)          │
│   2. tests/e2e/test_api_crud.py                    (field names + IDs)      │
│   3. tests/e2e/test_create_endpoints_auth.py       (+ organization_id)      │
│   4. tests/integration/test_workflow_complete.py   (+ tenant_id + cleanup)  │
│   5. tests/e2e/test_web_ui.py                      (+ routes)               │
│                                                                             │
│ FILES TO CREATE (New Models):                                              │
│   1. shared/py_libs/py_libs/pydantic/models/milestone.py                   │
│   2. shared/py_libs/py_libs/pydantic/models/datastore.py                   │
│   3. shared/py_libs/py_libs/pydantic/models/webhook.py                     │
│                                                                             │
│ FILES TO MODIFY (Web Configuration):                                       │
│   1. webui/nginx.conf                              (+ SPA fallback)         │
│                                                                             │
│ TOTAL: 14 files modified, 3 files created, 1 file updated                 │
│                                                                             │
└────────────────────────────────────────────────────────────────────────────┘

┌────────────────────────────────────────────────────────────────────────────┐
│ RISK ASSESSMENT                                                            │
├────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│ RISK LEVEL: LOW ✅                                                         │
│                                                                             │
│ Why Low Risk:                                                              │
│  • Changes isolated to test data and validation                            │
│  • No database schema changes                                              │
│  • No breaking API changes                                                 │
│  • Pydantic models are new (not modifying existing)                        │
│  • Email validation improvement is backward-compatible                     │
│                                                                             │
│ Potential Issues:                                                          │
│  • Tests may expose latent bugs (acceptable)                               │
│  • Multi-tenant deployments may need tenant_id adjustment (manageable)     │
│  • Admin UI changes depend on React implementation status (known issue)    │
│                                                                             │
└────────────────────────────────────────────────────────────────────────────┘

┌────────────────────────────────────────────────────────────────────────────┐
│ IMPLEMENTATION CHECKLIST                                                   │
├────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│ PHASE 1 - QUICK WINS                                                       │
│  ☐ Fix email NULL byte validation                                          │
│  ☐ Add tenant_id auto-derivation to organizations                          │
│  ☐ Update E2E test data (labels, entities, issues)                         │
│  ☐ Fix integration test setup (tenant_id, cleanup)                         │
│  ☐ Run Phase 1 tests - expect 23 new passes                                │
│                                                                             │
│ PHASE 2 - MODEL CREATION                                                   │
│  ☐ Create milestone.py Pydantic model                                      │
│  ☐ Create datastore.py Pydantic model                                      │
│  ☐ Create webhook.py Pydantic model                                        │
│  ☐ Update __init__.py exports                                              │
│  ☐ Update endpoint handlers with @validated_request                        │
│  ☐ Run Phase 2 tests - expect 3 new passes                                 │
│                                                                             │
│ PHASE 3 - WEB UI                                                           │
│  ☐ Create/register admin page components                                   │
│  ☐ Update nginx SPA fallback routing                                       │
│  ☐ Add security headers (middleware or nginx)                              │
│  ☐ Implement CSRF token support                                            │
│  ☐ Run Phase 3 tests - expect 13 new passes                                │
│                                                                             │
│ FINAL VALIDATION                                                           │
│  ☐ Run full test suite: pytest tests/ -v                                   │
│  ☐ Verify 120/120 tests passing                                            │
│  ☐ Check no regressions in passing tests                                   │
│  ☐ Review error messages are user-friendly                                 │
│  ☐ Verify API documentation updated                                        │
│                                                                             │
└────────────────────────────────────────────────────────────────────────────┘

ESTIMATED TOTAL TIME: 5-8 hours
DIFFICULTY LEVEL: MEDIUM
PRIORITY: HIGH (Test suite is critical for CI/CD)

For detailed implementation instructions, see:
  • .test_remediation_plan.md (comprehensive guide)
  • .test_analysis_summary.txt (detailed findings)

═══════════════════════════════════════════════════════════════════════════════
